<div class="min-h-screen">
  <!-- Header con pasos -->
  <app-header-with-steps
    [currentStep]="currentStep"
    [showBackButton]="true"
    (backClick)="onBackClick()"
  ></app-header-with-steps>

  <div class="flex flex-col gap-6 max-w-lg mx-auto p-6">
    <!-- Paso del formulario -->
    <app-step-indicator [step]="currentStep" [total]="4"></app-step-indicator>

    <!-- Vista inicial: Enviar código -->
    <div *ngIf="!codeSent" class="flex flex-col gap-8">
      <!-- Título de sección -->
      <app-section-title
        icon="mail_outline"
        [title]="t('auth.emailVerification.title')"
        [subtitle]="t('auth.emailVerification.subtitle')"
      ></app-section-title>

      <!-- Tarjeta de verificación -->
      <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center gap-6">
        <!-- Mensaje -->
        <div class="text-center">
          <p class="text-gray-600 mb-2 verification-message">{{ t('auth.emailVerification.message') }}</p>
          <p class="font-semibold text-gray-900 text-lg">{{ userEmail }}</p>
        </div>

        <!-- Botón principal -->
        <div class="w-full">
          <app-button
            [label]="t('auth.emailVerification.sendButton')"
            [isActive]="true"
            [isOutline]="false"
            iconName="send"
            (click)="sendVerificationCode()"
            onkeypress="if(event.key === 'Enter'){ sendVerificationCode(); }"
          ></app-button>
        </div>
      </div>

      <!-- Opciones adicionales -->
      <div class="flex flex-col gap-4 text-center mt-6">
        <!-- Hacer más tarde -->
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-gray-500 text-sm mb-3">{{ t('auth.emailVerification.laterMessage') }}</p>
          <app-button
            [label]="t('auth.emailVerification.laterButton')"
            [iconName]="'schedule'"
            [isActive]="true"
            [outlineGray]="true"
            (click)="doLater()"
            onkeypress="if(event.key === 'Enter'){ doLater(); }"
          ></app-button>
          <br />
          <app-button
            [label]="t('auth.emailVerification.backButton')"
            [isActive]="true"
            [outlineGray]="true"
            (click)="goBack()"
            onkeypress="if(event.key === 'Enter'){ goBack(); }"
          ></app-button>
        </div>
      </div>
    </div>

    <!-- Vista de verificación: Ingresar código -->
    <div *ngIf="codeSent" class="flex flex-col gap-8">
      <!-- Título de sección -->
      <app-section-title
        icon="security"
        [title]="t('auth.emailVerification.verifyTitle')"
        [subtitle]="t('auth.emailVerification.verifySubtitle')"
      ></app-section-title>

      <!-- Tarjeta de verificación -->
      <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col items-center gap-6">
        <!-- Mensaje -->
        <div class="text-center">
          <p class="text-gray-900 font-medium mb-1">{{ t('auth.emailVerification.codeSentTitle') }}</p>
          <p class="text-gray-600 text-sm mb-4">{{ t('auth.emailVerification.codeSentMessage') }}</p>
        </div>

        <!-- Formulario de código -->
        <form [formGroup]="verificationForm" class="w-full flex flex-col gap-4">
          <!-- Campo de código -->
          <app-input-field
            [label]="t('auth.emailVerification.codeLabel')"
            icon="pin"
            [placeholder]="t('auth.emailVerification.codePlaceholder')"
            formControlName="verificationCode"
          ></app-input-field>

          <!-- Botón verificar -->
          <app-button
            [label]="t('auth.emailVerification.verifyButton')"
            [isActive]="true"
            [isOutline]="false"
            iconName="check"
            (click)="verifyCode()"
            onkeypress="if(event.key === 'Enter'){ verifyCode(); }"
          ></app-button>
        </form>

        <!-- ¿No recibiste el código? -->
        <div class="text-center bg-blue-50 p-4 rounded-lg w-full">
          <p class="text-gray-600 text-sm mb-2">{{ t('auth.emailVerification.noCodeReceived') }}</p>
          <button
            class="text-blue-600 text-sm font-medium hover:text-blue-800 transition-colors"
            [disabled]="!canResendCode"
            (click)="resendCodeFromVerificationView()"
          >
            <span *ngIf="canResendCode">{{ t('auth.emailVerification.resendButton') }}</span>
            <span *ngIf="!canResendCode">
              {{ t('auth.emailVerification.resendIn')
              }}{{ countdownTimer < 10 ? '0' + countdownTimer : countdownTimer }}
            </span>
          </button>
        </div>
      </div>

      <!-- Opciones adicionales -->
      <div class="flex flex-col gap-4 text-center mt-6">
        <!-- Hacer más tarde -->
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-gray-500 text-sm mb-3">{{ t('auth.emailVerification.laterMessage') }}</p>
          <app-button
            [label]="t('auth.emailVerification.laterButton')"
            [iconName]="'schedule'"
            [isActive]="true"
            [outlineGray]="true"
            (click)="doLater()"
            onkeypress="if(event.key === 'Enter'){ doLater(); }"
          ></app-button>
          <br />
          <app-button
            [label]="t('auth.emailVerification.backButton')"
            [isActive]="true"
            [outlineGray]="true"
            (click)="goBack()"
            onkeypress="if(event.key === 'Enter'){ goBack(); }"
          ></app-button>
        </div>
      </div>
    </div>
  </div>
</div>
