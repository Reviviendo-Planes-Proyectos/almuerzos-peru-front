<div class="min-h-screen">
  <!-- Header con pasos -->
  <app-header-with-steps
    [currentStep]="currentStep"
    [showBackButton]="true"
    (backClick)="onBackClick()"
  ></app-header-with-steps>

  <div class="flex flex-col gap-6 max-w-sm mx-auto p-6">
    <!-- Paso del formulario -->
    <app-step-indicator [step]="currentStep" [total]="6"></app-step-indicator>

    <!-- Vista inicial: Enviar código -->
    <div *ngIf="!codeSent" class="flex flex-col gap-6">
      <!-- Icono grande centrado -->
      <div class="flex justify-center mb-4">
        <div class="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center">
          <i class="material-icons text-white text-3xl">phone</i>
        </div>
      </div>

      <!-- Título -->
      <div class="text-center mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-2">Verificar Celular</h2>
        <p class="text-gray-600 text-sm">Confirma tu número para recibir notificaciones</p>
      </div>

      <!-- Tarjeta principal -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <!-- Icono de teléfono y mensaje -->
        <div class="text-center mb-6">
          <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <i class="material-icons text-green-600 text-2xl">phone</i>
          </div>
          <p class="text-gray-700 text-sm mb-1">Enviaremos un código de verificación a:</p>
          <p class="font-semibold text-gray-900">{{ userPhone }}</p>
        </div>

        <!-- Pregunta sobre método -->
        <p class="text-center text-gray-700 text-sm mb-4">¿Cómo prefieres recibir el código?</p>

        <!-- Opciones SMS y WhatsApp -->
        <div class="flex gap-3 mb-6">
          <!-- SMS -->
          <button
            (click)="setPreferredMethod('sms')"
            [class]="
              preferredMethod === 'sms'
                ? 'flex-1 p-4 border-2 border-green-500 bg-green-50 rounded-xl transition-all'
                : 'flex-1 p-4 border-2 border-gray-200 bg-white rounded-xl hover:border-green-300 transition-all'
            "
          >
            <div class="flex flex-col items-center gap-2">
              <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                <i class="material-icons text-green-600 text-lg">sms</i>
              </div>
              <span class="text-sm font-medium text-gray-700">SMS</span>
              <span class="text-xs text-gray-500">Mensaje de texto</span>
            </div>
          </button>

          <!-- WhatsApp -->
          <button
            (click)="setPreferredMethod('whatsapp')"
            [class]="
              preferredMethod === 'whatsapp'
                ? 'flex-1 p-4 border-2 border-green-500 bg-green-50 rounded-xl transition-all'
                : 'flex-1 p-4 border-2 border-gray-200 bg-white rounded-xl hover:border-green-300 transition-all'
            "
          >
            <div class="flex flex-col items-center gap-2">
              <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                <i class="material-icons text-green-600 text-lg">chat</i>
              </div>
              <span class="text-sm font-medium text-gray-700">WhatsApp</span>
              <span class="text-xs text-gray-500">Mensaje directo</span>
            </div>
          </button>
        </div>

        <!-- Botón principal -->
        <app-button
          [label]="sendCodeButtonLabel"
          [isActive]="true"
          [iconName]="'send'"
          [isOutline]="false"
          (click)="sendVerificationCode()"
        ></app-button>
      </div>

      <!-- Opciones adicionales -->
      <!--    <div class="text-center mt-4">
        <p class="text-gray-500 text-sm mb-4">¿Prefieres verificar tu celular más tarde?</p>
        <app-button [label]="'Hacer Más Tarde'" [isActive]="true" [iconName]="'schedule'" [isOutline]="false"
          (click)="doLater()"></app-button>
        <br />
        <app-button [label]="'Atras'" [isActive]="true" [outlineGray]="true" (click)="goBack()"></app-button>
      </div> -->

      <div class="flex flex-col gap-4 text-center mt-6">
        <!-- Hacer más tarde -->
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-gray-500 text-sm mb-3">¿Prefieres verificar tu celular más tarde?</p>
          <app-button
            [label]="'Hacer Más Tarde'"
            [iconName]="'schedule'"
            [isActive]="true"
            [outlineGray]="true"
            (click)="doLater()"
          ></app-button>
          <br />
          <app-button [label]="'Atrás'" [isActive]="true" [outlineGray]="true" (click)="goBack()"></app-button>
        </div>
      </div>
    </div>

    <!-- Vista de verificación: Ingresar código -->
    <div *ngIf="codeSent" class="flex flex-col gap-6">
      <!-- Icono grande centrado -->
      <div class="flex justify-center mb-4">
        <div class="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center">
          <i class="material-icons text-white text-3xl">security</i>
        </div>
      </div>

      <!-- Título -->
      <div class="text-center mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-2">Verificar Celular</h2>
        <p class="text-gray-600 text-sm">Confirma tu número para recibir notificaciones</p>
      </div>

      <!-- Tarjeta principal -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <!-- Mensaje -->
        <div class="text-center mb-6">
          <p class="text-gray-900 font-medium mb-1">Código enviado por {{ sentMethodText }}</p>
          <p class="text-gray-600 text-sm">Revisa tus mensajes y confirma el código</p>
        </div>

        <!-- Formulario de código -->
        <form [formGroup]="verificationForm" class="flex flex-col gap-4">
          <!-- Campo de código -->
          <div class="relative">
            <!--        <input type="text" formControlName="verificationCode" placeholder="Ingresa el código de 6 dígitos"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-center tracking-widest"
              maxlength="6" /> -->
            <app-input-field
              label="Ingresa el código de 6 dígitos"
              icon="pin"
              placeholder="******"
              formControlName="verificationCode"
              type="text"
            ></app-input-field>
            <!--  <div class="absolute left-3 top-1/2 transform -translate-y-1/2">
              <i class="material-icons text-gray-400">pin</i>
            </div> -->
          </div>

          <!-- Botón verificar -->
          <button
            type="button"
            (click)="verifyCode()"
            [disabled]="isVerifying"
            class="w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium py-3 rounded-xl transition-colors flex items-center justify-center gap-2"
          >
            <!-- Spinner de carga -->
            <div *ngIf="isVerifying" class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>

            <!-- Ícono normal -->
            <i *ngIf="!isVerifying" class="material-icons text-lg">check</i>

            <!-- Texto del botón -->
            <span>{{ isVerifying ? 'Verificando...' : 'Verificar Código' }}</span>
          </button>
        </form>

        <!-- ¿No recibiste el código? -->
        <div class="text-center mt-6 bg-blue-50 p-4 rounded-xl">
          <p class="text-gray-600 text-sm mb-2">¿No recibiste el código?</p>
          <button
            class="text-blue-600 text-sm font-medium hover:text-blue-800 transition-colors"
            [disabled]="!canResendCode"
            (click)="resendCode()"
          >
            <span *ngIf="canResendCode">Reenviar en {{ resendMethodText }}</span>
            <span *ngIf="!canResendCode">
              Reenviar en 0:{{ countdownTimer < 10 ? '0' + countdownTimer : countdownTimer }}
            </span>
          </button>
          <div class="mt-2">
            <button
              class="text-blue-600 text-sm font-medium hover:text-blue-800 transition-colors"
              (click)="preferredMethod === 'sms' ? setPreferredMethod('whatsapp') : setPreferredMethod('sms')"
            >
              Cambiar a {{ preferredMethod === 'sms' ? 'WhatsApp' : 'SMS' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Opciones adicionales -->
      <!--  <div class="text-center mt-4">
        <p class="text-gray-500 text-sm mb-4">¿Prefieres verificar tu celular más tarde?</p>
        <app-button [label]="'Hacer Más Tarde'" [isActive]="true" [iconName]="'schedule'" [isOutline]="false"
          (click)="doLater()"></app-button>
        <br />
        <app-button [label]="'Atras'" [isActive]="true" [outlineGray]="true" (click)="goBack()"></app-button>

      </div> -->

      <div class="flex flex-col gap-4 text-center mt-6">
        <!-- Hacer más tarde -->
        <div class="bg-gray-50 p-4 rounded-lg">
          <p class="text-gray-500 text-sm mb-3">¿Prefieres verificar tu celular más tarde?</p>
          <app-button
            [label]="'Hacer Más Tarde'"
            [iconName]="'schedule'"
            [isActive]="true"
            [outlineGray]="true"
            (click)="doLater()"
          ></app-button>
          <br />
          <app-button [label]="'Atrás'" [isActive]="true" [outlineGray]="true" (click)="goBack()"></app-button>
        </div>
      </div>
    </div>
  </div>
</div>
